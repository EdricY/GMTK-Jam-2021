(()=>{"use strict";var e={d:(t,a)=>{for(var s in a)e.o(a,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:a[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{H:()=>Ve,t:()=>We});const t=e=>document.getElementById(e),a=1e3,s=500,n=t("canvas");n.width=a,n.height=a;const i=n.getContext("2d"),o=2*Math.PI,r=Math.SQRT1_2,l=100,h=l*Math.SQRT2,c=["Amphitrite","Brizo","Cymopoleia","Doris","Electra","Glaucus","Hippocampi","Ichthyocentaurs","Kympoleia","Leucothea","Nerites","Poseiden"],p=["Low","Medium","High"],u=["North","South","East","West"],d=(e,t)=>!(e<0||e>=10||null!=t&&(t<0||t>=10)),m=["Anemone Place","Fishers Palace","Riverswood Mansion","Stonewill Residence","Wild Willow Estate","Troutriver Mansion","Beechbury Residence","Foreherd Chateau","Suldal Estate","Remlins Residence","Pardel Manor","Nordon Chateau","Grapevine Manor","Graceville Manor","Edgeriver Manor","Froglake Estate","Summergrove Chateau","Livingtero Manor","Fullercard Chateau","Consworth Chateau","Sinrett Chateau","Buckfort Chateau","Ivywood Mansion","Newpoint Mansion","Eastmeadow Chateau","Gracewoods Estate","Seapoint Residence","Mauner Manor","Mulsay Residence","Pakennelly Mansion","Colerene Chateau","Rothsnor Residence","Castle Hill Residence","Starlight Residence","Evergreen Valley Estate","Crow Valley Chateau","Blossomfall Mansion","Blanson Manor","Goldrow Manor","Rainnell Estate","Warridge Manor","Coulton Manor"],g=["Oscar Smith","Don Lino","Angie Zellweger","Lenny Black","Lola Jolie","Sykes Scorsese","Ernie Marley","Bernie Doug","Frankie Imperioli","Luca Pastore","Cleo Jones","Don Limpet","Guppi Goldberg","Ann Chovy","Cece Lioness","Marlin Brooks","Nemo Gould","Gill Dafoe","Peach Janney","Gurgle Pendleton","Patrick Fager","Araceli Maldonado","Lexi Fowler","Tony Mccullough","Emiliano Stuart","Aliya Ferrell","Seamus Juarez","Ty Luna","Francisco Pham","Casey Kennedy","Haylee Oneill","Kristopher Sweeney","Kelsie Barrera","Kendall Rhodes","Yareli Braun","Monserrat Greer","Tyree Wyatt","Allen Cruz","Julianne Lowe","Gabriela George","Lukas Boyer","Liam Lam","Gustavo Walter","Zion Dean","Akira Whitaker"];function y(e){for(var t=e.length-1;t>0;t--){var a=Math.floor(Math.random()*(t+1)),s=e[t];e[t]=e[a],e[a]=s}}y(g),y(m);const f={grass:"./assets/grass.png",road:"./assets/road.png",road2:"./assets/road2.png",road3:"./assets/road3.png",house:"./assets/house.png",shell:"./assets/shell.png",shell2:"./assets/shell2.png",shell3:"./assets/shell3.png",shell4:"./assets/shell4.png",sand:"./assets/sand.png",sand2:"./assets/sand2.png",sand3:"./assets/sand3.png",anemone11:"./assets/anemone1-1.png",anemone12:"./assets/anemone1-2.png",anemone13:"./assets/anemone1-3.png",anemone21:"./assets/anemone2-1.png",anemone22:"./assets/anemone2-2.png",anemone23:"./assets/anemone2-3.png",anemone41:"./assets/anemone4-1.png",anemone42:"./assets/anemone4-2.png",anemone43:"./assets/anemone4-3.png",question:"./assets/question.png",exclamation:"./assets/exclamation.png",fish1:"./assets/fish2.png",fish2:"./assets/fish3.png",fish3:"./assets/fish4.png",fish4:"./assets/fish5.png",fish5:"./assets/fish6.png",fish6:"./assets/fish7.png",couple1:"./assets/Couple1.png",couple2:"./assets/Couple2.png",couple3:"./assets/Couple3.png",couple4:"./assets/Couple4.png",couple5:"./assets/Couple5.png",couple6:"./assets/Couple6.png",couple7:"./assets/Couple7.png",couple8:"./assets/Couple8.png",couple9:"./assets/Couple9.png"},T={coins:"./assets/coins2.wav",moneybag:"./assets/moneybag.wav",craft:"./assets/craft.mp3",bloop:"./assets/bloop.wav",bloop2:"./assets/bloop2.mp3",speech:"./assets/speech.mp3",bubble:"./assets/bubble.wav",uhoh:"./assets/uhoh.wav",peacefulSea1:"./assets/peaceful_sea1.mp3",peacefulSea2:"./assets/peaceful_sea2.mp3",peacefulSea3:"./assets/peaceful_sea3.mp3",background1:"./assets/background1.mp3"},b={},x={};let w=0;const M=Object.keys(f).length+Object.keys(T).length,v=e=>{w++},k=.75;class L{constructor(){this.musicTracks=this.shuffleMusic([x.background1]),this.currentTrack=Math.floor(Math.random()*this.musicTracks.length)}reset(){this.musicTracks[this.currentTrack].currentTime=0}play(){this.musicTracks[this.currentTrack].currentTime=0,this.musicTracks[this.currentTrack].volume=k,this.musicTracks[this.currentTrack].play()}update(){let e=this.musicTracks[this.currentTrack];e.currentTime>=e.duration&&(this.currentTrack=(this.currentTrack+1)%this.musicTracks.length,this.play())}shuffleMusic(e){for(var t,a=e.length;0!==a;)t=Math.floor(Math.random()*a),a--,[e[a],e[t]]=[e[t],e[a]];return e}}class B{constructor(){this.state=0}static get MENU(){return 0}static get CRED(){return 1}static get GAME(){return 2}static get DYING(){return 3}static get WINNING(){return 4}inState(e){return this.state==e}setState(e){this.inState(e)||(this.state=e,S[B.GAME].classList.add("nodisplay"),S[B.MENU].classList.add("nodisplay"),S[B.CRED].classList.add("nodisplay"),S[e].classList.remove("nodisplay"))}}const P=new B,S={};S[B.GAME]=t("game"),S[B.MENU]=t("menu"),S[B.CRED]=t("credits");const E=500;let C,A=E;function D(){A--,A>0?(i.globalAlpha=1,i.drawImage(C,0,0),i.globalAlpha=(E-A)/E,i.fillStyle="black",i.fillRect(0,0,a,a),requestAnimationFrame(D),x.background1.volume=k*A/E):(i.fillStyle="black",i.globalAlpha=1,i.fillRect(0,0,a,a),x.uhoh.currentTime=0,x.uhoh.play(),x.background1.pause(),x.background1.volume=k,setTimeout((()=>{P.setState(B.MENU)}),500))}let R=!1;function N(){A--,A>0?(i.globalAlpha=1,i.drawImage(C,0,0),i.globalAlpha=(E-A)/E,i.fillStyle="white",i.fillRect(0,0,a,a),requestAnimationFrame(N),x.background1.volume=k*A/E):(i.fillStyle="white",i.globalAlpha=1,i.fillRect(0,0,a,a),x.background1.pause(),x.background1.volume=k,R?setTimeout((()=>{t("winner").classList.remove("nodisplay"),P.setState(B.CRED)}),500):setTimeout((()=>{P.setState(B.GAME),x.bloop.currentTime>0&&(x.bloop.currentTime=0),x.bloop.volume=.3,x.bloop.speed=4,x.bloop.play(),We()}),500))}function j(e,t){const a=function(e,t,a=0,s=0){return[a+r*(e-a)-r*(t-s),s+r*(e-a)+r*(t-s)]}(t*l,e*l,s,s);return a[1]=a[1]/2+250,a}function G(e,t){const a=function(e,t,a=0,s=0){return[a+r*(e-a)+r*(t-s),s-r*(e-a)+r*(t-s)]}(e,2*(t-s)+s,s,s);return a[0]/=l,a[1]/=l,a}function I(e,t){const a=t-e+1;return Math.floor(e+Math.random()*a)}function F(){return 2*Math.random()-1}const H=h/64,O=1e3,W=new class{i=-1;j=-1;alive=!1;timer=O+Math.floor(Math.random()*O);offsetI=-.25*Math.random()+.5;offsetJ=-.25*Math.random()+.5;imgname="shell";place(){this.imgname=["shell","shell2","shell3","shell4"][I(0,3)];let e=null;this.timer=O+Math.floor(Math.random()*O),this.offsetI=-.5*Math.random(),this.offsetJ=-.5*Math.random();do{this.i=Math.floor(10*Math.random()),this.j=Math.floor(10*Math.random()),e=He.mapNumbers[this.i][this.j]}while(3!=e)}pickup(){this.alive=!1,this.place()}update(){this.timer--,this.timer<=0&&(this.alive=!this.alive,this.timer=O+Math.floor(Math.random()*O),this.place())}draw(e){if(!this.alive)return;const[t,a]=j(this.i,this.j);e.drawImage(b[this.imgname],t-h/2+this.offsetI,a-b.shell.height*H/2+this.offsetJ,h,b.shell.height*H)}getAmount(){const e=V.lifetimeMax/20;return I(e/2,e)}},J=new class{constructor(e,t){this.x=e,this.y=t,this.timer=0,this.timerlength=120,this.amt=0}trigger(e,t,a){this.x=e,this.y=t,this.timer=120,this.amt=a}update(){this.timer>0&&this.timer--}draw(e){this.timer>0&&(e.font="bold 28px Verdana",e.fillStyle="#89FFD2",e.textAlign="center",e.fillText("+ "+this.amt,this.x,this.y-(120-this.timer)/10))}},V=new class{constructor(){this.setup()}setup(){this.actual=0,this.display=0,this.step=0,this.lifetimeMax=0}update(){0!=this.step&&(this.display+=this.step),this.step>0&&this.display>=this.actual&&(this.display=this.actual,this.step=0),this.step<0&&this.display<=this.actual&&(this.display=this.actual,this.step=0)}draw(){t("shellCount").innerText=Math.floor(this.display)}change(e){this.actual+e<0?console.log("not enough money"):(this.display=this.actual,this.actual+=e,this.step=e/60,this.actual>this.lifetimeMax&&(this.lifetimeMax=this.actual))}};class z{constructor(e,t){this.name=e,this.imgname=t,this.content="<ul><li>A thing</li><li>Another thing</li></ul>",this.expireTimer=Q,this.maintenance=Math.floor(Math.random()*p.length),this.location=Math.floor(Math.random()*u.length),this.color=Math.random()<.2?"Gray":"Pink"}update(){this.expireTimer--}}const q={x:-1,y:-1},Y={i:-1,j:-1},U=["fish1","fish2","fish3","fish4","fish5","fish6"],K=["couple1","couple2","couple3","couple4","couple5","couple6","couple7","couple8","couple9"];let _=1700;const Q=3e3;let Z=!0;const X=new class{constructor(){this.setup()}setup(){this.nextApplicant=0,this.applicants=[],this.resetTimer()}resetTimer(){this.spawnTimer=_+Math.floor(Math.random()*_/2)}viewNextApplicant(){Y.i=-1,Y.j=-1,0!==this.applicants.length&&(this.applicants[0].expireTimer=Math.min(Q,this.applicants[0].expireTimer+Q/4),ce.openApplicantBox(this.applicants[0]))}spawnApplicant(){const e=je.getOwnedProperties().length;if(0==e)return void this.resetTimer();this.resetTimer();let t=g[Math.floor(Math.random()*g.length)],a=U[Math.floor(Math.random()*U.length)];if(Math.random()<.3){let e=t.split(" ");t=e[0]+" & "+g[Math.floor(Math.random()*g.length)],a=K[Math.floor(Math.random()*K.length)]}this.applicants.push(new z(t,a)),this.setButtonState(),_=1700-e/25*1e3}setButtonState(){0==this.applicants.length||"applicant"==ce.currentPanelType||"eom"==ce.currentPanelType?t("viewNextApplicantBtn").disabled=!0:(t("viewNextApplicantBtn").disabled=!1,Z&&(Z=!1,t("viewNextApplicantBtn").classList.add("flash"),setTimeout((()=>{t("viewNextApplicantBtn").classList.remove("flash")}),2e3)))}update(){this.spawnTimer--,this.spawnTimer<=0&&this.spawnApplicant();for(let e=0;e<this.applicants.length;e++)this.applicants[e].update(),this.applicants[0].expireTimer<=0&&(0==e&&"applicant"==ce.currentPanelType&&ce.closeAll(),this.applicants.splice(e--,1));0===this.applicants.length&&(t("viewNextApplicantBtn").disabled=!0)}draw(){if(t("applicantCount").innerText=this.applicants.length,"applicant"==ce.currentPanelType){const e=this.applicants[0].expireTimer/Q;t("appProgress").style.width=100*e+"%"}}},$={cost:200,increment:20};let ee=[];function te(){ee=[];for(let e=0;e<He.mapNumbers.length;e++){ee.push([]);for(let t=0;t<He.mapNumbers[0].length;t++)ee[e][t]=ae(e,t)}}const ae=(e,t)=>{const a={size:1,i:e,j:t};return a.parent=a,a.houses=Re.includes(He.mapNumbers[e][t])?1:0,a},se=e=>(e.parent!==e&&(e.parent=se(e.parent)),e.parent),ne=(e,t)=>{const a=se(e),s=se(t);if(a===s)return;const n=a.houses+s.houses;a.size<s.size?(a.parent=s,s.size=a.size+s.size,s.houses=n):(s.parent=a,a.size=a.size+s.size,a.houses=n)},ie=2e3,oe=new class{constructor(){this.setup()}setup(){this.timer=ie,this.numSkipped=0,this.cost=100}update(){"eom"==ce.currentPanelType?this.timer--:this.timer=ie,0==this.timer&&ce.payLater()}skip(){this.numSkipped++,this.numSkipped>=3&&ce.openDead("Sorry bud. Not this time. I never told you what happened to my last property manager..."),this.cost=Math.max(5*this.cost,Math.floor(1.5*V.lifetimeMax))}paid(){this.cost=Math.max(4*this.cost,Math.floor(1.5*V.lifetimeMax))}getMessage(){return 1==this.numSkipped?"Okay... but you'll be paying an extra premium next time...":2==this.numSkipped?"You knew the end of the month was coming, right? You're pushing the limit here...":3==this.numSkipped?"I won't be so forgiving next time.":void 0}draw(){t("sharkProgress").style.width=100*this.timer/ie+"%"}},re=["Looks like you're in pretty deep, huh?","Lucky for you, my rental manager position just opened up.  But I think you'll be here a while before you can pay off what you owe.","We're always getting plenty of applicants, so just scoop up some property, approve some folks, and start collecting rent.","I'll come by at the end of the month to collect what you owe. I hear that shell debt you've racked up is raking in quite a bit of interest, haha!","You better be able to cover your monthly payments. You wouldn't wanna end up like the last guy...","Of course if you were ever able to buy and rent out the Grand Anenome, I'd be willing to let this all go.","Well, as if that were even possible for someone like you. Haha, good luck out there. I'll see you soon!","One more thing. Apparently the fish around here like living in places that are joined together. I don't get it. But areas connected by roads seem to do a lot better."],le=new class{step=0;getMessage(){return re[this.step]}nextStep(){this.step++,this.step<re.length?(x.speech.currentTime=0,x.speech.play(),t("welcomeMsg").innerText=this.getMessage()):ce.closeAll()}},he=[t("infoBox-welcome"),t("infoBox-house"),t("infoBox-applicant"),t("infoBox-sand"),t("infoBox-property"),t("infoBox-eom"),t("infoBox-dead")],ce=new class{constructor(){this.currentPanelType="",he.forEach((e=>e.classList.add("nodisplay")))}closeAll(){this.currentPanelType="",he.forEach((e=>e.classList.add("nodisplay"))),X.setButtonState()}openWelcomeBox(){this.currentPanelType="welcome",he.forEach((e=>e.classList.add("nodisplay"))),t("infoBox-welcome").classList.remove("nodisplay"),le.step=-1,le.nextStep()}openHouseBox(e){e.owned?this.openPropertyBox(e):(this.currentPanelType="house",he.forEach((e=>e.classList.add("nodisplay"))),t("infoBox-house").classList.remove("nodisplay"),t("image-house").src=f[e.imgname],t("name-house").innerText=e.name,t("value-house").innerText=Math.round(e.basePrice),t("rent-house").innerText=Math.round(e.rent),t("location-house").innerText=e.getLocation(),t("maintenance-house").innerText=p[e.maintenance],t("occupant-house").innerText=e.tenant?e.tenant.name+e.getTenantState():"Vacant")}openPropertyBox(e){e.owned?(this.currentPanelType="property",he.forEach((e=>e.classList.add("nodisplay"))),t("infoBox-property").classList.remove("nodisplay"),t("image-property").src=f[e.imgname],t("name-property").innerText=e.name,t("value-property").innerText=Math.round(e.basePrice),t("rent-property").innerText=Math.round(e.rent),t("location-property").innerText=e.getLocation(),t("maintenance-property").innerText=p[e.maintenance],t("occupant-property").innerText=e.tenant?e.tenant.name+e.getTenantState():"Vacant",t("evictBtn").disabled=!e.tenant,t("repairBtn").disabled=!e.broken,t("repairBtn").innerText="Repair"+(e.broken?" ("+e.costToFix+")":"")):this.openHouseBox(e)}openSandBox(e){this.currentPanelType="sand",he.forEach((e=>e.classList.add("nodisplay"))),t("infoBox-sand").classList.remove("nodisplay"),e.road?(t("image-sand").src=f[e.imgname],t("name-sand").innerText="Shell Road",t("details-sand").innerText="A road paved with shells",t("roadBtnRow").classList.add("nodisplay")):(t("image-sand").src=f[e.imgname],t("name-sand").innerText="Sand",t("details-sand").innerText="A large patch of sand.",t("roadBtnRow").classList.remove("nodisplay"),t("roadCost").innerText=$.cost)}openApplicantBox(e){this.currentPanelType="applicant",he.forEach((e=>e.classList.add("nodisplay"))),t("infoBox-applicant").classList.remove("nodisplay"),X.setButtonState(),t("image-applicant").src=f[e.imgname],t("name-applicant").innerText=e.name,t("location-applicant").innerText=u[e.location],t("maintenance-applicant").innerText=p[e.maintenance],t("color-applicant").innerText=e.color,t("image-residence").src=f.question,t("name-residence").src="Select an owned Residence",t("joinBtn").disabled=!0,this.selectResidence(null)}selectResidence(e){if("applicant"==this.currentPanelType){if(!e||!e.owned)return t("image-residence").src=f.question,t("name-residence").innerText="Select an owned Residence",t("joinBtn").disabled=!0,t("value-residence").innerText="?",t("rent-residence").innerText="?",t("location-residence").innerText="?",t("maintenance-residence").innerText="?",void(t("occupant-residence").innerText="?");t("joinBtn").disabled=!1,e.tenant?t("joinBtn").innerText="Evict & Join":t("joinBtn").innerText="Join",t("image-residence").src=f[e.imgname],t("name-residence").innerText=e.name,t("value-residence").innerText=Math.round(e.basePrice),t("rent-residence").innerText=Math.round(e.rent),t("location-residence").innerText=e.getLocation(),t("maintenance-residence").innerText=p[e.maintenance],t("occupant-residence").innerText=e.tenant?e.tenant.name+e.getTenantState():"Vacant"}}openEOM(){this.currentPanelType="eom",x.speech.currentTime=0,x.speech.play(),he.forEach((e=>e.classList.add("nodisplay"))),t("infoBox-eom").classList.remove("nodisplay"),X.setButtonState(),t("sharkMsg").innerHTML="I'm back. This month's payment is...<br>"+oe.cost,t("sharkProgressBorder").classList.remove("nodisplay"),t("sharkMsgBtns").classList.add("nodisplay"),t("sharkPayBtns").classList.add("nodisplay"),setTimeout((()=>{t("sharkPayBtns").classList.remove("nodisplay")}),1e3)}payLater(){this.currentPanelType="",oe.skip(),t("sharkPayBtns").classList.add("nodisplay"),t("sharkProgressBorder").classList.add("nodisplay"),t("sharkMsg").innerText=oe.getMessage(),t("sharkMsgBtns").classList.remove("nodisplay")}paidShark(){this.currentPanelType="",oe.paid(),t("sharkPayBtns").classList.add("nodisplay"),t("sharkProgressBorder").classList.add("nodisplay"),t("sharkMsg").innerText="Thanks bud! Same time next month. Hahaha!",t("sharkMsgBtns").classList.remove("nodisplay")}openDead(e){this.currentPanelType="eom",he.forEach((e=>e.classList.add("nodisplay"))),t("infoBox-dead").classList.remove("nodisplay"),t("deadMsg").innerText=e,C=document.createElement("img"),C.src=n.toDataURL(),P.state=B.DYING,A=E,D()}};let pe;const ue=(e=500)=>{x.bloop2.currentTime=0,x.bloop2.play(),t("denyBtn").classList.add("flash"),t("name-residence").classList.add("flash"),clearTimeout(pe),pe=setTimeout((()=>{t("name-residence").classList.remove("flash"),t("denyBtn").classList.remove("flash")}),e)};let de,me;const ge=(e=500)=>{x.bloop2.currentTime=0,x.bloop2.play(),t("roadBtn").classList.add("flash"),t("shellCount").classList.add("flash"),clearTimeout(me),me=setTimeout((()=>{t("shellCount").classList.remove("flash"),t("roadBtn").classList.remove("flash")}),e)};let ye,fe;class Te{constructor(e,t,a){this.x=e+10*F(),this.y=t,this.vy=-.2*Math.random()-.3,this.vx=.5*(Math.random()-Math.random()),this.r=1+Math.random()*a,this.color=Math.random()<.5?"white":"#c1fae7"}update(){this.x+=this.vx,this.y+=this.vy}draw(e){e.beginPath(),e.lineWidth=1,e.fillStyle=this.color,e.arc(this.x,this.y,this.r,0,o),e.fill(),e.closePath(),this.r-=.1,this.vx+=.2*F(),this.vy-=.1*Math.random()}}const be=new class{parts=[];update(){for(let e=0;e<this.parts.length;e++){const t=this.parts[e];t.update(),t.r<=0&&this.parts.splice(e--,1)}}draw(e){for(let t=0;t<this.parts.length;t++)this.parts[t].draw(e)}generate(e,t,a=5,s=5){for(let n=0;n<a;n++){const a=new Te(e,t,s);this.parts.push(a)}}},xe=h/92;let we=JSON.parse(JSON.stringify(m));class Me{constructor(e,t,a){const[s,n]=j(e,t);this.x=s,this.y=n,this.i=e,this.j=t,this.moneyTimer=0,this.moneyDur=60,this.moneyAmount=0,this.lastDelta=0,0===we.length&&(we=JSON.parse(JSON.stringify(m)),we=we.filter((e=>void 0===je.mapData.flat().find((t=>t.name===e))))),this.basePrice=a,this.tenant=null,this.owned=!1,this.lastPriceAdj=Date.now(),this.isHouse=!0,this.broken=!1,this.costToFix=0,this.maintenance=Math.floor(Math.random()*p.length),this.breakChance=.02*(this.maintenance+1)}get rent(){return Math.round(this.basePrice/10)}buy(){this.owned||(V.actual<this.basePrice?((e=500)=>{x.bloop2.currentTime=0,x.bloop2.play(),t("buyBtn").classList.add("flash"),t("shellCount").classList.add("flash"),clearTimeout(de),de=setTimeout((()=>{t("shellCount").classList.remove("flash"),t("buyBtn").classList.remove("flash")}),e)})(500):(x.coins.currentTime=0,x.coins.play(),this.owned=!0,V.change(-this.basePrice)))}repair(){this.owned&&this.broken&&(V.actual<this.costToFix?((e=500)=>{x.bloop2.currentTime=0,x.bloop2.play(),t("repairBtn").classList.add("flash"),t("shellCount").classList.add("flash"),clearTimeout(ye),ye=setTimeout((()=>{t("shellCount").classList.remove("flash"),t("repairBtn").classList.remove("flash")}),e)})(500):(x.craft.currentTime=0,x.craft.play(),V.change(-this.costToFix),this.broken=!1,t("repairBtn").disabled=!0,t("occupant-property").innerText=this.tenant?this.tenant.name+this.getTenantState():"Vacant"))}evict(){this.tenant&&(this.tenant=null,this.select())}sell(){this.owned&&(x.moneybag.currentTime=0,x.moneybag.play(),this.owned=!1,this.broken=!1,this.tenant=null,V.change(this.basePrice))}payRent(){const e=ee[this.i][this.j],t=se(e).houses;let a=0;t>2&&(a=Math.round(t/10*this.rent),a=Math.min(a,this.basePrice/3));const s=Math.round(this.rent)+a;be.generate(this.x,this.y),V.change(s),this.moneyAmount=s,this.moneyTimer=this.moneyDur}getTenantModifier(){let e=0;return this.tenant&&(u[this.tenant.location]===this.getLocation()?e+=.2:e-=.3,this.tenant.maintenance>this.maintenance?e+=.15:this.tenant.maintenance===this.maintenance?e+=.1:e-=.2,this.tenant.color===this.color?e+=.2:e-=.4),this.owned&&this.broken&&(e-=.9),e}getTenantState(){let e=this.getTenantModifier();return e<0?" (ðŸ˜Ÿ)":e<.25?" (ðŸ˜)":" (ðŸ˜Š)"}adjustPrice(e){const t=this.basePrice/10;let a=e+.5*F();this.tenant&&(a+=this.getTenantModifier());let s=Math.round(a*t);"Pink"==this.color&&s+this.basePrice>250&&(s=0),this.basePrice+=s,this.lastDelta=s}getLocation(){return this.i<6&&this.j<6?"North":this.i<6&&this.j>=6?"East":this.i>=6&&this.j<6?"West":"South"}select(){ce.openHouseBox(this),x.bubble.currentTime>0&&(x.bubble.currentTime=0),x.bubble.volume=.7,x.bubble.play()}cycle(e){this.owned&&this.tenant&&Math.random()<this.breakChance&&V.lifetimeMax>300&&(this.broken=!0,this.costToFix=Math.round(this.basePrice/10)+1),this.adjustPrice(e),Y.i===this.i&&Y.j===this.j&&(t("name-house").innerText=this.name,t("name-property").innerText=this.name,t("name-residence").innerText=this.name,t("value-house").innerText=Math.round(this.basePrice),t("value-property").innerText=Math.round(this.basePrice),t("value-residence").innerText=Math.round(this.basePrice),t("rent-house").innerText=Math.round(this.rent),t("rent-property").innerText=Math.round(this.rent),t("rent-residence").innerText=Math.round(this.rent),t("occupant-property").innerText=this.tenant?this.tenant.name+this.getTenantState():"Vacant",this.broken&&(t("repairBtn").innerText="Repair ("+this.costToFix+")",t("repairBtn").disabled=!1))}draw(e){if(this.owned&&je.strokeLoc(e,this.i,this.j,"#ff00cc",3),this.isGrand){const t=["anemone41","anemone42","anemone43"][Math.floor(Date.now()/1e3)%3];e.drawImage(b[t],this.x-h,this.y-b[t].height*xe/2,2*h,b[t].height*xe)}else{let t=this.imgname;if(this.imgframeNames){const e=Math.floor((Date.now()+this.offset)/1500)%4;t=this.imgframeNames[e]}e.drawImage(b[t],this.x-h/2,this.y-b[t].height*xe/2,h,b[t].height*xe)}if(this.broken){const t=5*Math.sin(Date.now()/100);e.drawImage(b.exclamation,this.x-b.exclamation.width/2,this.y-b.exclamation.height-t)}if(e.textAlign="center",e.font="bold 28px Verdana",e.fillStyle="black",this.owned){let t="Vacant";this.tenant&&(t=this.tenant.name.split(" ").pop()),e.fillText(t,this.x,this.y-15),e.fillText(this.basePrice,this.x,this.y+15)}else{let t=this.isGrand?20:10;e.fillText(this.basePrice,this.x,this.y-t)}if(this.moneyTimer>0){e.font="bold 28px Verdana",e.fillStyle="#89FFD2",this.moneyTimer--;const t=this.moneyTimer/this.moneyDur;e.fillText("+"+this.moneyAmount,this.x,this.y-50*(1-t))}}}class ve extends Me{constructor(e,t){super(e,t,50+I(-25,25)),this.imgname=["anemone11","anemone12","anemone13"][I(0,2)],this.imgframeNames=["anemone11","anemone12","anemone13","anemone12"],this.offset=I(0,4e3),this.color="Pink",this.name=Pe[Be],Be=(Be+1)%Pe.length}}class ke extends Me{constructor(e,t){super(e,t,1e3+I(-50,50)),this.imgname=["anemone21","anemone22","anemone23"][I(0,2)],this.imgframeNames=["anemone21","anemone22","anemone23","anemone22"],this.offset=I(0,4e3),this.name=Ee[Se],Se=(Se+1)%Ee.length,this.color="Gray"}}class Le extends Me{constructor(e,t){super(e,t,99999),this.imgname=["anemone41","anemone42","anemone43"][I(0,2)],this.name="Grand Anemone",this.isGrand=!0}cycle(){}}let Be=0;const Pe=["Anemone Corner","Fishers Commons","Riverswood Cottage","Stonewill Gables","Wild Willow Place","Troutriver Place","Beechbury Residence","Foreherd House","Suldal Place","Remlins Residence","Pardel Pad","Nordon House","Graceville Loft","Edgeriver Commons","Froglake Place","Beechbury Residence","Foreherd House","Suldal Place","Remlins Residence","Pardel Loft","Nordon House","Grapevine Loft","Graceville Loft","Edgeriver Loft","Edgeriver Loft","Froglake Place","Beechbury Residence","Foreherd House","Suldal Place","Remlins Residence","Pardel Loft","Nordon House","Grapevine Loft","Graceville Loft","Edgeriver Loft"];let Se=0;const Ee=["Foreherd Chateau","Suldal Estate","Remlins Residence","Pardel Manor","Nordon Chateau","Grapevine Manor","Graceville Manor","Edgeriver Manor","Froglake Estate","Summergrove Chateau","Livingtero Manor","Fullercard Chateau","Consworth Chateau","Sinrett Chateau","Buckfort Chateau","Ivywood Mansion","Newpoint Mansion","Eastmeadow Chateau","Gracewoods Estate","Seapoint Residence","Mauner Manor","Mulsay Residence","Pakennelly Mansion","Colerene Chateau","Rothsnor Residence","Castle Hill Residence","Starlight Residence","Evergreen Valley Estate","Crow Valley Chateau","Blossomfall Mansion","Blanson Manor","Goldrow Manor","Rainnell Estate","Warridge Manor","Coulton Manor"],Ce=h/92;class Ae{constructor(e,t){this.road=!1;const[a,s]=j(e,t);this.x=a,this.y=s,this.i=e,this.j=t,this.imgname=["sand","sand2","sand3"][I(0,2)]}changeToRoad(){this.road=!0,this.imgname=["road","road2","road3"][I(0,2)]}draw(e){e.drawImage(b[this.imgname],this.x-h/2,this.y-b[this.imgname].height*Ce/2,h,b[this.imgname].height*Ce)}select(){ce.openSandBox(this)}}const De=[2,4,5],Re=[2,4,5],Ne=h/92,je=new class{setup(){this.mapData=[];for(let e=0;e<He.mapNumbers.length;e++){this.mapData.push([]);for(let t=0;t<He.mapNumbers[0].length;t++){const a=He.mapNumbers[e][t];2==a&&(this.mapData[e][t]=new ve(e,t)),4==a&&(this.mapData[e][t]=new ke(e,t)),3==a&&(this.mapData[e][t]=new Ae(e,t)),5==a&&(this.mapData[e][t]=new Le(e,t))}}}drawField(e){for(let t=0;t<this.mapData.length;t++)for(let a=0;a<this.mapData[0].length;a++){const s=He.mapNumbers[t][a],n=this.mapData[t][a],[i,o]=j(t,a);3==s&&n?.draw?n.draw(e):e.drawImage(b.sand,i-h/2,o-b.sand.height*Ne/2,h,b.sand.height*Ne)}}drawObjects(e){for(let t=0;t<this.mapData.length;t++)for(let a=0;a<this.mapData[0].length;a++){const s=He.mapNumbers[t][a],n=this.mapData[t][a];De.includes(s)&&n?.draw?.(e),W.i==t&&W.j==a&&W.draw(e);const[i,o]=j(t,a),r=ee[t][a],l=se(r).houses;if(l>1){let e=Math.min(2+l/2,5);be.generate(i,o,Math.random()<.1?1:0,e)}}}cycle(e){for(let t=0;t<this.mapData.length;t++)for(let a=0;a<this.mapData[0].length;a++){const s=this.mapData[t][a],[n,i]=j(t,a);s?.cycle&&s.cycle(e)}}strokeLoc(e,t,a,s="green",n=4){e.save();const[i,o]=j(t,a);e.translate(i-h/2,o-h/2),e.beginPath(),e.moveTo(0,h/2),e.lineTo(h/2,h/4),e.lineTo(h,h/2),e.lineTo(h/2,3*h/4),e.lineTo(0,h/2),e.closePath(),e.strokeStyle=s,e.lineWidth=n,e.stroke(),e.restore()}getOwnedProperties(){return this.mapData.flat().filter((e=>e.owned))}},Ge=new class{constructor(){this.setup()}setup(){this.cycleStart=Date.now(),this.pauseTime=0,this.paused=!1,this.day=0,this.month=0}pause(){this.pauseTime=Date.now(),this.paused=!0}unPause(){this.cycleStart=Date.now()-(this.pauseTime-this.cycleStart),this.paused=!1}update(){this.paused||Date.now()-this.cycleStart>5e3&&this.cycle()}cycle(){this.cycleStart=Date.now(),this.day++,je.mapData.flat().filter((e=>e.isHouse&&e.tenant)).forEach((e=>e.payRent())),this.day>28&&(this.month=(this.month+1)%12,this.day=1,ce.openEOM());const e=.1+.5*F();je.cycle(e),t("date").innerText=c[this.month]+" "+this.day}},Ie=[[3,4,3,3,5,3,3,3,3,3],[2,3,4,3,3,3,3,3,3,3],[4,3,4,3,3,3,3,4,3,3],[3,2,3,3,3,3,3,4,3,3],[2,3,2,2,3,3,4,3,3,4],[3,3,3,3,3,3,3,3,2,4],[3,2,2,3,3,3,2,3,3,3],[3,3,3,3,2,3,3,2,3,3],[3,3,2,3,3,3,2,3,3,2],[3,3,3,2,3,3,3,2,3,3]],Fe=[Ie],He=new class{constructor(){this.currentLevel=0,this.mapNumbers=Ie}nextLevel(){let e=!1;this.currentLevel++,this.currentLevel>=Fe.length&&(this.currentLevel=0,e=!0),function(e){C=document.createElement("img"),C.src=n.toDataURL(),P.state=B.WINNING,A=E,R=e,N()}(e),X.setup(),Ge.setup(),this.mapNumbers=Fe[this.currentLevel],je.setup(),te(),V.setup(),oe.setup()}reset(){this.currentLevel=0,X.setup(),Ge.setup(),this.mapNumbers=Fe[this.currentLevel],je.setup(),te(),V.setup(),oe.setup()}};let Oe;function We(){requestAnimationFrame(Je),ce.openWelcomeBox(),Oe=Oe||new L,Oe.play(),He.reset(),V.change(100)}function Je(){je.mapData.flat().filter((e=>e.isGrand)).every((e=>e.tenant))?He.nextLevel():(W.update(),J.update(),V.update(),X.update(),Ge.update(),Oe.update(),oe.update(),be.update()),function(){i.clearRect(0,0,a,a),je.drawField(i);const[e,t]=G(q.x,q.y),s=Math.round(e),n=Math.round(t);(function(e,t,a){d(t,a)&&"eom"!=ce.currentPanelType&&("applicant"!=ce.currentPanelType?je.strokeLoc(e,t,a,"red",2):je.mapData[t][a]?.owned&&je.strokeLoc(e,t,a,"red",5))})(i,n,s),d(Y.i,Y.j)&&(je.strokeLoc(i,Y.i,Y.j),"applicant"==ce.currentPanelType&&je.strokeLoc(i,Y.i,Y.j,"purple",8)),je.drawObjects(i),be.draw(i),J.draw(i),V.draw(),X.draw(),oe.draw(),i.font="20px serif",i.fillStyle="white"}(),P.inState(B.GAME)&&requestAnimationFrame(Je)}function Ve(){if(P.state!=B.GAME)return;if("welcome"==ce.currentPanelType)return void le.nextStep();const[e,a]=G(q.x,q.y),s=Math.round(a),n=Math.round(e);if(s==W.i&&n==W.j){const e=W.getAmount();V.change(e),W.pickup(),J.trigger(q.x,q.y,e),x.moneybag.currentTime=0,x.moneybag.play(),be.generate(q.x,q.y)}if("applicant"==ce.currentPanelType){if(!d(s,n))return ce.selectResidence(null),void ue(500);let e=je.mapData[s][n];return void(e?.owned?(ce.selectResidence(e),Y.i=s,Y.j=n):ue(500))}if("eom"==ce.currentPanelType)return void(s==W.i&&n==W.j||((e=500)=>{x.bloop2.currentTime=0,x.bloop2.play(),t("laterBtn").classList.add("flash"),clearTimeout(fe),fe=setTimeout((()=>{t("laterBtn").classList.remove("flash")}),e)})());if(!d(s,n))return void ce.closeAll();let i=je.mapData[s][n];Y.i=s,Y.j=n,i?.select&&(be.generate(q.x,q.y),i.select())}var ze;je.setup(),window.addEventListener("load",(()=>{t("playBtn").addEventListener("click",(()=>{P.setState(B.GAME),x.bloop.currentTime>0&&(x.bloop.currentTime=0),x.bloop.volume=.3,x.bloop.speed=4,x.bloop.play(),We()})),t("creditsBtn").addEventListener("click",(()=>{x.bloop.currentTime>0&&(x.bloop.currentTime=0),x.bloop.volume=.3,x.bloop.speed=4,x.bloop.play(),P.setState(B.CRED)})),t("creditsBackBtn").addEventListener("click",(()=>{x.bloop.currentTime>0&&(x.bloop.currentTime=0),x.bloop.volume=.3,x.bloop.speed=4,x.bloop.play(),P.setState(B.MENU)})),n.addEventListener("mousemove",(e=>{const t=function(e){return[Math.round(e.offsetX*n.width/n.clientWidth),Math.round(e.offsetY*n.height/n.clientHeight)]}(e);q.x=t[0],q.y=t[1]})),n.addEventListener("click",(e=>{Ve()})),t("viewNextApplicantBtn").addEventListener("click",(()=>{x.bloop.currentTime>0&&(x.bloop.currentTime=0),x.bloop.volume=.3,x.bloop.speed=4,x.bloop.play(),X.viewNextApplicant()})),t("buyBtn").onclick=()=>{if(!d(Y.i,Y.j))return;const e=je.mapData[Y.i][Y.j];e.basePrice&&(e.buy(),ce.openPropertyBox(e))},t("sellBtn").onclick=()=>{if(!d(Y.i,Y.j))return;const e=je.mapData[Y.i][Y.j];e.basePrice&&(e.sell(),ce.closeAll())},t("repairBtn").onclick=()=>{if(!d(Y.i,Y.j))return;const e=je.mapData[Y.i][Y.j];e.basePrice&&e.repair()},t("welcomeBtn").onclick=()=>{le.nextStep()},t("denyBtn").onclick=()=>{ce.closeAll(),X.applicants[0].expireTimer=0},t("joinBtn").onclick=()=>{const e=X.applicants[0],t=je.mapData[Y.i][Y.j];e&&t&&(t.evict(),t.tenant=e,e.expireTimer=0,ce.closeAll(),x.bloop.currentTime=0,x.bloop.play())},t("evictBtn").onclick=()=>{const e=je.mapData[Y.i][Y.j];e&&e.evict()},t("payEomBtn").onclick=()=>{V.actual>=oe.cost?(V.change(-oe.cost),ce.paidShark(),x.coins.currentTime=0,x.coins.play()):ce.openDead("You can't fool me! There's not enough here. I never told you what happened to my last property manager...")},t("laterBtn").onclick=()=>{ce.payLater()},t("dismissSharkBtn").onclick=()=>{ce.closeAll()},t("roadBtn").onclick=()=>{if(V.actual<$.cost)return void ge(500);x.coins.currentTime=0,x.coins.play(),V.change(-$.cost),$.cost+=$.increment,$.increment+=10;const e=je.mapData[Y.i][Y.j];e.road||(e.changeToRoad(),function(e,t){for(const[a,s]of[[0,1],[0,-1],[1,0],[-1,0]]){const n=e+a,i=t+s;if(!d(n,i))continue;const o=je.mapData[n][i];o&&(o.road||o.isHouse)&&ne(ee[e][t],ee[n][i])}}(Y.i,Y.j),e.select())},te(),V.change(1e3)})),ze=()=>t("playBtn").disabled=!1,window.addEventListener("load",(()=>{!function(){for(let e in f)b[e]=new Image,b[e].src=f[e],b[e].onload=v;for(let e in T)x[e]=new Audio(T[e]),x[e].onloadeddata=v}();let e=setInterval((()=>{w==M&&(clearInterval(e),ze())}),500)}))})();